"use strict";if(window.Another===undefined)throw new Error("Another.Routing requires Another");(function(a){var n=a.CreateApplication("Another.Routing");n.Configure(function(){a.RouteBuilder=function(n){var ts=this,container=a.DomHelper(n),t,i;this.MapRoute=function(n,t,i){if(container.length>0){if(a.Helpers.StringIsNullOrEmpty(n))throw new Error("RouteBuilder: name cannot be null or empty");if(a.Helpers.StringIsNullOrEmpty(t))throw new Error("RouteBuilder: route cannot be null or empty");if(a.Helpers.IsUndefinedOrNull(i))throw new Error("RouteBuilder: route cannot be null or empty");if(a.Helpers.Any(ts.Routes,function(t){return t.Name===n}))throw"RouteBuilder: there is already a route named "+n;a.Helpers.EndsWith(t,"/")&&(t=a.Helpers.StripLast(t));Another.Helpers.StartsWith(t,"/")&&(t=a.Helpers.StripFirst(t));ts.Routes.push({Name:n,Route:t,Chunks:t.split("/"),Defaults:i})}return ts};this.AddRoutingController=function(n,t){if(container.length>0){if(ts.Controllers[n]!==undefined)throw new Error("RouteBuilder: controller "+n+" already exists");ts.Controllers[n]=new t}return ts};t=function(){var chunkPath,qSplit,i,r,isMvc,actualController,actualAction,strCall,i2;if(container.length>0){if(a.Helpers.IsUndefinedOrNull(a.Route)||a.Helpers.IsUndefinedOrNull(a.Route.Presenter)||delete a.Route.Presenter,a.Route={},a.Helpers.StringIsNullOrEmpty(window.location.hash)){window.location.hash="/";a.RaiseEvent("OnRouteRedirect",{Route:a.Route,Message:"Trailing slash not present"});return}a.RaiseEvent("OnRouteChangeStart",{Route:a.Route});var hash=window.location.hash,splt=hash.split("#"),searchSplt=splt[1].split("?");if(a.Route.Path=searchSplt[0],chunkPath=a.Route.Path,a.Helpers.StartsWith(chunkPath,"/")&&(chunkPath=a.Helpers.StripFirst(chunkPath)),a.Helpers.EndsWith(chunkPath,"/")&&(chunkPath=a.Helpers.StripLast(chunkPath)),a.Route.PathNoSlashes=chunkPath,a.Route.Chunks=chunkPath.split("/"),a.Route.QueryString=searchSplt[1]||"",a.Route.Search={},a.Helpers.StringIsNullOrEmpty(a.Route.QueryString)||(qSplit=a.Route.QueryString.split("&"),qSplit.forEach(function(n){var t=n.split("=");a.Route.Search[t[0]]=t[1]})),!a.Helpers.EndsWith(a.Route.Path,"/")){window.location.hash=a.Route.Path+"/"+(a.Helpers.StringIsNullOrEmpty(a.Route.QueryString)?"":"?"+a.Route.QueryString);a.RaiseEvent("OnRouteRedirect",{Route:a.Route,Message:"Trailing slash not present"});return}var routeFound=null,controller=null,action=null,view=null,presenter=null;for(a.Route.Chunks.length<1&&a.Route.Chunks.push(""),i=0;i<ts.Routes.length;i++)if(r=ts.Routes[i],r.Route==="{controller}/{action}"){controller=a.Route.Chunks[0]||r.Defaults.controller;action=a.Route.Chunks[1]||r.Defaults.action;routeFound=r;break}else if(a.Helpers.StartsWith(a.Route.PathNoSlashes,r.Route)){view=r.Defaults.view;presenter=r.Defaults.presenter;routeFound=r;break}if(routeFound===null){a.RaiseEvent("OnRouteNotFound",{Route:a.Route,Message:"No route found for this path"});return}if(isMvc=controller!==null&&action!==null,!isMvc&&(a.Helpers.StringIsNullOrEmpty(view)||a.Helpers.StringIsNullOrEmpty(presenter))){a.RaiseEvent("OnRouteNotFound",{Route:a.Route,Message:"Routes are incorrectly configured"});return}if(isMvc){if(actualController=ts.Controllers[controller],a.Helpers.IsUndefinedOrNull(actualController)&&(actualController=ts.Controllers[controller.toLowerCase()]),a.Helpers.IsUndefinedOrNull(actualController)){a.RaiseEvent("OnRouteNotFound",{Route:a.Route,Message:"Cannot find controller "+controller});return}if(actualAction=actualController[action],a.Helpers.IsUndefinedOrNull(actualAction)&&(action=action.toLowerCase(),actualAction=ts.Controllers[action]),a.Helpers.IsUndefinedOrNull(actualAction)){a.RaiseEvent("OnRouteNotFound",{Route:a.Route,Message:"Cannot find action "+action});return}for(strCall="actualController[action](",i2=2;i2<a.Route.Chunks.length;i2++)strCall+="'"+a.Route.Chunks[i2]+"'",i2+1<a.Route.Chunks.length&&(strCall+=",");strCall+=");";eval(strCall)}else presenter!==null&&view!==null?ts.View(view,presenter):a.RaiseEvent("OnRouteNotFound",{Route:a.Route,Message:"Presenter or View default is null for this route"})}};this.SetViewContainer=function(){container.length>0&&(a.DomHelper(window).bind("hashchange",function(){t()}),t())};this.Routes=[];this.Controllers={};this.Views={};this.CacheViews=function(n){return i=n,ts};i=!1;this.View=function(n,t){if(container.length>0){var r=ts.Views[n];r?(container.html(r),a.InitializePresenter(t,container,a.Route.Chunks.splice(2)),a.Route.Presenter=t,a.Route.View=n,a.RaiseEvent("OnRouteChangeSuccess",{Route:a.Route})):a.DomHelper.get(n).success(function(r){i&&(ts.Views[n]=r);container.html(r);a.InitializePresenter(t,container,a.Route.Chunks.splice(2));a.Route.Presenter=t;a.Route.View=n;a.RaiseEvent("OnRouteChangeSuccess",{Route:a.Route,View:n,Presenter:t})}).error(function(){throw new Error("Could not load view "+n);})}}};a.AnotherApplication.prototype.ConfigureRoutes=function(n,t){var i=new a.RouteBuilder(n);t(i);i.SetViewContainer()}})})(Another);
//# sourceMappingURL=Another.Routing.min.js.map
